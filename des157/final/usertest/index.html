<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catch-A-Pig!</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Lobster+Two&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <h1>Catch A Pig! <span class="score" style="visibility: hidden;">0</span><span id="timer" style="visibility: hidden;"></span></h1>
  <div class="menu">
    <table style="width: 100%;">
    <tbody>
    <tr>
      <td style="width: 60%;">
        <h2 class="rules">Rules: The mischevious pigs have gotten loose in the farm. Hurry and catch as much as you can within 30 seconds so they can be returned safely to their pen. When you see a pig pop out, click on it to return it safely back to its pen. </h2>
      </td>
      <td style="width: 40%;"> <img class="pig" src="images/pig.PNG" alt="pig" /></td>
    </tr>
    </tbody>
    </table>
    </div>

  <button id="lets-play" >Let's Play</button>

  <div class="game" style="visibility:hidden;">
    <div class="hole hole1">
      <div class="mole"></div>
    </div>
    <div class="hole hole2">
      <div class="mole"></div>
    </div>
    <div class="hole hole3">
      <div class="mole"></div>
    </div>
    <div class="hole hole4">
      <div class="mole"></div>
    </div>
    <div class="hole hole5">
      <div class="mole"></div>
    </div>
    <div class="hole hole6">
      <div class="mole"></div>
    </div>
  </div>
  <button class="btn" onClick="startGame()" style="display:none">Start!</button>

<script>
  alert("Hello! Welcome to Catch-A-Pig. There are three tasks that I would like you to complete: 1) Find the game rules and read them. 2) Play the game and try to catch as many pigs as you can in 30 seconds. 3) Keep track of how many pigs you have caught.");
  const holes = document.querySelectorAll('.hole');
  const scoreBoard = document.querySelector('.score');
  const moles = document.querySelectorAll('.mole');
  let lastHole;
  let timeUp = false;
  let score = 0;
  // Create new audio objects
  const rollsound = new Audio('media/rolling-dice.mp3');
  const winsound = new Audio('media/win-sound.mp3');
  const awsound = new Audio('media/aw-sound.mp3');
  const clicksound = new Audio('media/click-sound.mp3');

  document.getElementById("lets-play").addEventListener("click", function() {

    document.querySelector(".game").style.visibility = "";
    document.querySelector(".score").style.visibility = "";
    document.querySelector(".btn").style.display = "block";
    document.querySelector(".menu").style.display = "none";
    document.getElementById("timer").style.visibility = "";
    document.getElementById("lets-play").style.display = "none";
  })

  function randomTime(min, max) {
    return Math.round(Math.random() * (max-min) + min);
  }

  function randomHole(holes){
    const idx = Math.floor(Math.random() * holes.length);
    const hole = holes[idx];
    if(hole === lastHole) {
      console.log("Ah nah that's the same one bud");
      return randomHole(holes);
    }
    lastHole = hole;
    return hole;
  }

  function peep(){
    const time = randomTime(500, 1500);
    const hole = randomHole(holes);
    hole.classList.add("up");

    setTimeout(() => {
      hole.classList.remove('up');
      if(!timeUp) peep();
    }, time)
}

function startGame() {
  scoreBoard.textContent = 0;
  timeUp = false;
  score = 0;
  peep();
  setTimeout(() => timeUp = true, 30000);

  const startingMinutes = 0.5;
    let time = startingMinutes * 60;

    const countdownEl = document.getElementById('timer');

    setInterval(updateCountdown, 1000);

    function updateCountdown() {
      const minutes = Math.floor(time/60);
      let seconds = time % 60;

      seconds = seconds < 10 ? '0' + seconds : seconds;

      countdownEl.innerHTML = `${minutes}: ${seconds}`;
      time--;
      time = time < 0 ? 0 : time; 
    }
}

function bonk(e) {
  if(!e.isTrusted) return; //cheaters
  score++;
  this.classList.remove('up');
  scoreBoard.textContent = score;
  clicksound.play();
}

moles.forEach(mole => mole.addEventListener("click", bonk));


</script>
</body>
</html>